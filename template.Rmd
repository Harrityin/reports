---
title: "大脑学习能力测评"
subtitle: "集体报告"
date: "2017年12月8日"
output:
  word_document:
    toc: true
    fig_caption: true
    reference_docx: docs/word-styles-reference-report.docx
toc-title: "目录"
params:
  user_info:
    label: "学生信息:"
    value: data/test.rds
    input: file
  time:
    label: "学生测评时间:"
    value: ""
    input: date
---

```{r load packages and data, include=FALSE}
# load packages
library(tidyverse)
library(extrafont)
# configuration settings
data_file <- params$user_info
ability_names <- c("反应力", "注意力", "记忆力", "自控力", "思维力")
meta_vars <- c("userId", "姓名", "性别", "学校", "年级", "班")
lesson_vars <- c("语文", "数学")
rnk_cutedges_ability <- qnorm(c(0, 0.3, 0.7, 0.9, 1)) * 15 + 100
# load data
user_raw_data <- read_rds(data_file) 
# check time input
assess_time <- params$time
if (assess_time == "")
  # if not input assess time, use the median of createDate
  assess_time <- median(user_raw_data$createDate)
# do some transformations
user_data <- user_raw_data %>%
  filter(!is.na(姓名)) %>% 
  gather("能力", "得分", 持续注意:自控力, na.rm = TRUE) %>%
  # score of 0 indicates missing data
  mutate(得分 = ifelse(得分 == 0, NA, 得分)) %>%
  # some users have more than one record
  group_by_at(vars(one_of(c(meta_vars, "能力")))) %>%
  mutate(rank = row_number(desc(得分))) %>% 
  ungroup() %>% 
  filter(rank == 1) %>%
  # remain only variables of interest
  select(one_of(c(meta_vars, lesson_vars, "能力", "得分"))) %>% 
  filter(能力 %in% ability_names) %>% 
  # get the A-D rank for each ability
  mutate(rank = cut(得分, rnk_cutedges_ability, LETTERS[4:1])) %>%
  # change order of grade and class
  mutate(
    年级 = factor(
      年级, c("一", "二", "三", "四"), c("一年级", "二年级", "三年级", "四年级")
    ),
    班 = factor(班, 1:length(unique(班)))
  )
schools <- unique(user_data$学校)
```

# 报告说明

---

“大脑学习能力”测评系统（以下简称学习能力测评）由北京师范大学脑与学习科学研究中心与成都爱智游科技有限公司联合编制。“大脑学习能力”测评系统整合了国际国内脑科学研究最新成果，依据脑功能分化和整合原理，以及大脑功能可塑性原理，采用计算机化认知测试的方式，全面测查与个体学习和发展密切相关的“大脑学习能力”。同传统智力测验相比，“大脑学习能力”测评具有科学性强、实施方便、准确度高、预测效度好、可反复测试等优势，代表了当今脑力测试的新趋势。

“大脑学习能力”测评综合考察注意力、记忆力、反应力、自控力等与人脑信息加工、学习、适应和发展密切相关的重要高级功能和大脑学习能力。这些能力覆盖了大脑的核心功能网络，是人脑智慧的集中体现。大量证据表明，个体在这些能力中的表现与其智力，学习能力，社会适应能力和未来发展潜力具有密切关系。

“大脑学习能力”测评提供多种能力维度指标，包含综合的大脑学习能力指数（Brain Learning Ablility Index, BLAI）和各个能力维度指数（注意力指数、记忆力指数、反应力指数、自控力指数）。

# 学生参加测评的情况

---

**测评时间**：`r strftime(assess_time, "%Y年%b") # format as "yyyy年MM月"`

**实测人数[^1]**：`r length(unique(user_data$userId))`人

```{r count users, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
user_data %>% 
  group_by(学校, 年级) %>% 
  summarise(人数 = length(unique(userId))) %>% 
  knitr::kable(caption = "各学校各年级实测人数[^order]")
```

[^1]: 即实际测得数据中，至少包含五项能力中的一项的学生总数，可能会少于计划参加测评的学生总数。
[^order]: 学校排名不分先后。

# 第一部分 大脑学习能力指数

---

```{r calculate BLAI, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
BLAI <- user_data %>% 
  group_by_at(vars(one_of(c(meta_vars, lesson_vars)))) %>% 
  summarise(BLAI = mean(得分, na.rm = TRUE)) %>% 
  mutate(rank = cut(BLAI, rnk_cutedges_ability, LETTERS[4:1]))
```

综合能力分数由大脑学习能力指数（BLAI）表示，它反映了注意力、记忆力、自控力、反应力这四方面认知能力的综合水平。
