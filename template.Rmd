---
title: "大脑学习能力测评"
subtitle: "集体报告"
date: "2017年12月8日"
output:
  word_document:
    toc: true
    fig_caption: true
    reference_docx: docs/word-styles-reference-report.docx
toc-title: "目录"
params:
  user_info:
    label: "学生基本信息:"
    value: data/user_info_test.rds
    input: file
  user_exam:
    label: "学生考试得分:"
    value: data/user_exam_test.rds
    input: file
  user_ability:
    label: "学生能力得分:"
    value: data/user_ability_test.rds
    input: file
  time:
    label: "学生测评时间:"
    value: ""
    input: date
---

```{r load packages and data, include=FALSE}
# load packages
library(tidyverse)
library(extrafont)
# parse params
user_info_file <- params$user_info
user_exam_file <- params$user_exam
user_ability_file <- params$user_ability
assess_time <- params$time
# configuration settings
meta_vars <- c("userId", "姓名", "性别", "学校", "年级", "班")
rnk_cutedges_ability <- qnorm(c(0, 0.3, 0.7, 0.9, 1)) * 15 + 100
# load user information
user_info <- read_rds(user_info_file)
# load user exam information
user_exam <- read_rds(user_exam_file)
# load user ability score
user_ability <- read_rds(user_ability_file)
# if not input assess time, use the median of createDate
if (assess_time == "")
  assess_time <- median(user_ability$createDate)
# do some transformations
schools <- unique(user_info$学校)
```

# 报告说明

---

“大脑学习能力”测评系统（以下简称学习能力测评）由北京师范大学脑与学习科学研究中心与成都爱智游科技有限公司联合编制。“大脑学习能力”测评系统整合了国际国内脑科学研究最新成果，依据脑功能分化和整合原理，以及大脑功能可塑性原理，采用计算机化认知测试的方式，全面测查与个体学习和发展密切相关的“大脑学习能力”。同传统智力测验相比，“大脑学习能力”测评具有科学性强、实施方便、准确度高、预测效度好、可反复测试等优势，代表了当今脑力测试的新趋势。

“大脑学习能力”测评综合考察注意力、记忆力、反应力、自控力等与人脑信息加工、学习、适应和发展密切相关的重要高级功能和大脑学习能力。这些能力覆盖了大脑的核心功能网络，是人脑智慧的集中体现。大量证据表明，个体在这些能力中的表现与其智力，学习能力，社会适应能力和未来发展潜力具有密切关系。

“大脑学习能力”测评提供多种能力维度指标，包含综合的大脑学习能力指数（Brain Learning Ablility Index, BLAI）和各个能力维度指数（注意力指数、记忆力指数、反应力指数、自控力指数）。

# 学生参加测评的情况

---

**测评时间**：`r strftime(assess_time, "%Y年%b") # format as "yyyy年MM月"`

**实测人数[^1]**：`r length(unique(user_ability$userId))`人

```{r count users, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
user_info %>%
  group_by(学校, 年级) %>%
  summarise(人数 = length(unique(userId))) %>%
  knitr::kable(caption = "各学校各年级实测人数[^order]")
```

[^1]: 即实际测得数据中，至少包含五项能力中的一项的学生总数，可能会少于计划参加测评的学生总数。
[^order]: 学校排名不分先后。

# 详细报告

---

## 大脑学习能力指数

```{r calculate BLAI, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
BLAI <- user_ability %>%
  group_by(userId) %>%
  summarise(BLAI = mean(abscore, na.rm = TRUE)) %>%
  mutate(rank = cut(BLAI, rnk_cutedges_ability, LETTERS[4:1])) %>%
  left_join(user_info)
```

综合能力分数由大脑学习能力指数（BLAI）表示，它反映了注意力、记忆力、自控力、反应力这四方面认知能力的综合水平。

```{r summary statistics for BLAI by grade, cache=TRUE, echo=FALSE}
BLAI %>%
  group_by(学校, 年级) %>%
  summarise(
    人数 = n(),
    平均分 = mean(BLAI),
    标准差 = sd(BLAI),
    最高分 = max(BLAI),
    最低分 = min(BLAI),
    A = sum(rank == "A"),
    B = sum(rank == "B"),
    C = sum(rank == "C"),
    D = sum(rank == "D")
  ) %>%
  knitr::kable(digits = 2, caption = "BLAI指数简表[^2]")
```

[^2]: A，B，C，D四个等级分别表示优秀（全国同龄水平90%以上），良好（全国同龄水平70%-90%），普通（全国同龄水平30%-70%），不足（全国同年龄水平30%以下）。表中列出了处于各个等级的学生人数。

```{r summary statistics for BLAI by class, cache=TRUE, echo=FALSE}
BLAI %>%
  group_by(学校, 年级, 班) %>%
  summarise(
    人数 = n(),
    平均分 = mean(BLAI),
    标准差 = sd(BLAI),
    最高分 = max(BLAI),
    最低分 = min(BLAI),
    A = sum(rank == "A"),
    B = sum(rank == "B"),
    C = sum(rank == "C"),
    D = sum(rank == "D")
  ) %>%
  knitr::kable(digits = 2, caption = "各年级各班BLAI指数简表")
```

### 各年级成绩与BLAI指数的相关关系

```{r lesson and BLAI, cache=TRUE, echo=FALSE, fig.cap=fig_captions, message=FALSE, warning=FALSE}
fig_captions <- paste0(schools, "学生成绩和BLAI指数的相关关系")
BLAI_exam <- user_exam %>%
  inner_join(BLAI)
for (school in schools){
  schoolplot <- BLAI_exam %>%
    filter(学校 == school) %>%
    ggplot(aes(BLAI, 成绩, color = 学科)) +
    geom_point() +
    stat_smooth(method = "glm") +
    facet_wrap(~年级, scales = "free")
  # render the plot
  print(schoolplot)
  # in order that the captions would render
  cat("\n\n")
}
```
