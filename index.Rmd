---
title: "大脑学习能力测评"
subtitle: "学校集体报告"
date: "`r format(Sys.time(), '%Y年%b%e日')`"
toc-title: "目录"
params:
  ability_scores_file:
    label: "学生能力得分："
    value: data/daxing/ability_scores.xlsx
    input: file
  school_name:
    label: "学校名称："
    value: 北京市大兴区兴华中学
    input: text
  test_date_auto:
    label: "是否自动获得学生测评时间？"
    value: true
    input: checkbox
  test_date:
    label: "学生测评时间（取消勾选上一项后请认真填写）："
    value: !r date()
    input: date
---

```{r configs, include=FALSE}
# load packages ----
library(tidyverse)
library(readxl)
library(extrafont)

# setting for Chinese font ----
# use Android Sans font, more info at
# https://www.freechinesefont.com/simplified-traditional-droid-sans-fallback/
text_family <- "Droid Sans Fallback"
# import font if not found
if (!text_family %in% fonts()) {
  font_import(prompt = FALSE, pattern = "DroidSansFallback")
}

# knitr options ----
# do not display NA
options(knitr.kable.NA = '')

# parse params ----
ability_scores_file <- params$ability_scores_file
school_name <- params$school_name
test_date_auto <- params$test_date_auto
test_date <- params$test_date

# datasets preparations ----
# load ability scores
ability_scores_district <- read_excel(ability_scores_file)
# filter out scores for current school
if (!school_name %in% ability_scores_district$school) stop("School not found!")
ability_scores_school <- ability_scores_district %>%
  filter(school == school_name)
# combine data from whole district, this school and each class
ability_scores_combined <- list(
  本区 = ability_scores_district,
  本校 = ability_scores_school,
  各班 = ability_scores_school
) %>%
  bind_rows(.id = "region") %>%
  mutate(cls = if_else(region != "各班", region, cls)) %>%
  mutate(region = factor(region, c("各班", "本校", "本区")))
# set test date
if (test_date_auto) {
  test_date <- median(ability_scores_school$createTime)
}
```

```{r user-defined-functions, include=FALSE}
#' Summarise function used for summary table generation
#'
#' @param raw_tab Raw data table as a data.frame
#' @return The summarised table
sum_tab <- function(raw_tab) {
  out_tab <- raw_tab %>%
    group_by(region, cls) %>%
    summarise(
      实测人数 = n(),
      平均分 = mean(score, na.rm = TRUE),
      标准差 = sd(score, na.rm = TRUE),
      最高分 = max(score, na.rm = TRUE),
      最低分 = min(score, na.rm = TRUE),
      A = sum(level == "A", na.rm = TRUE),
      B = sum(level == "B", na.rm = TRUE),
      C = sum(level == "C", na.rm = TRUE),
      D = sum(level == "D", na.rm = TRUE)
    ) %>%
    ungroup()
  return(out_tab)
}

#' custom theme setter for histogram/density plot
#'
#' @param base_size base font size
#' @param base_family base font family
set_theme_dist <- function(base_size = 18, base_family = "") {
  theme_minimal(base_size, base_family) %+replace%
    theme(
      axis.title.x = element_text(margin = margin(t = 1, unit = "lines")),
      axis.line.x = element_line(),
      axis.ticks.x = element_line(),
      panel.grid = element_blank(),
      plot.margin = margin(1, 1, 1, 1, unit = "lines")
    )
}

#' custom theme setter for three virtual panels graphs
#'
#' @param base_size base font size
#' @param base_family base font family
set_theme_panels <- function(base_size = 18, base_family = "") {
  theme_minimal(base_size, base_family) %+replace%
    theme(
      # x axis is at the bottom
      axis.title.x = element_text(margin = margin(t = 1, unit = "lines")),
      # disable facet panel labels
      strip.text = element_blank(),
      strip.background = element_blank(),
      # ensure facet panels are concatenated
      panel.spacing = unit(-0.5, "lines"),
      # remain major x grid only
      panel.grid = element_blank(),
      panel.grid.major.x = element_line(linetype = "dotdash", color = "grey")
    )
}
```

# 报告说明

<!-- 使用没有序号的格式 -->
## 项目背景介绍

<!-- 本次测试基于什么背景下进行实施 （可以跟协同中心要 -->
<!-- 共施测多少个学校，多少学生 -->

<!-- 使用没有序号的格式 -->
## “大脑学习能力”测评系统介绍

本次测评使用“大脑学习能力”测评系统（以下简称学习能力测评），该测评由北京师范大学脑与学习科学研究中心编制，整合了国际国内脑科学研究最新成果，依据脑功能分化和整合原理，以及大脑功能可塑性原理，采用计算机化认知测试的方式，全面测查与个体学习和发展密切相关的“大脑学习能力”。同传统智力测验相比，“大脑学习能力”测评具有科学性强、实施方便、准确度高、预测效度好、可反复测试等优势，代表了当今脑力测试的新趋势。

## 测评内容简介

本次测评主要包括基础能力测评和基础数学能力测评两部分。其中，基础能力测评包含多种维度指标，即大脑学习能力指数（BLAI）和各个子能力维度指数(注意力指数、记忆力指数、自控力指数、反应力指数和思维力指数)。大量证据表明，个体在这些维度所代表的能力中的表现与其智力，学习能力，社会适应能力和未来发展潜力具有密切关系。同时，因为基础数学能力是学习其他学科的基础，所以我们还重点考察了数学学科基础能力，以测试学生的数学能力发展情况。

<!-- 使用没有序号的格式 -->
## 学生参加测评的情况

* 测评学校：`r school_name`
* 测评时间：`r format(test_date, "%Y年%b")`
* 实测人数：`r n_distinct(ability_scores_school$userId)`人

# 详细报告

## 大脑学习能力指数（BLAI）

```{r blai-config, include=FALSE}
ab_type <- "基础学习能力"
ability_scores_combined_thisab <- ability_scores_combined %>%
  filter(ability == ab_type)
bp_stats <- boxplot.stats(ability_scores_combined_thisab$score)
```
基础能力测评情况由大脑学习能力指数（BLAI）表示，它反映了注意力、记忆力、自控力、反应力和思维力这五个方面认知能力的综合水平，分数越高代表认知能力的综合水平发展越高。

<!-- 本校和本区的BLAI指数分布对比 -->
```{r blai-histogram, echo=FALSE, warning=FALSE, message=FALSE}
ability_scores_combined_thisab %>%
  filter(region != "各班") %>%
  ggplot(aes(score, fill = region)) +
  geom_density(color = NA, alpha = 0.5) +
  scale_y_continuous(breaks = NULL, expand = c(0, 0)) +
  scale_fill_brewer(palette = "Paired") +
  labs(x = "分数", y = "", fill = "") +
  set_theme_dist(base_family = text_family)
```

全校学生总体的基础能力测评的得分分布见图1-3，从图中可以看出，本校学生得分主要集中在【】区间中，整体表现较【】。与全区分布相比，在【】区组学生比例更大。
（注释：
对每张图进行命名；
截取出分数的主要集中范围；
并对整体表现作出评价）

<!-- 本区、本校和本校各班的箱型图 -->
```{r blai-boxplot, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(ability_scores_combined_thisab, aes(cls, score, fill = cls)) +
  geom_boxplot(outlier.color = NA, width = 0.5) +
  facet_wrap(~ region, scales = "free_y", ncol = 1) +
  scale_y_continuous(limits = bp_stats$stats[c(1, 5)]) +
  scale_fill_brewer(palette = "Pastel1", guide = FALSE) +
  labs(x = "", y = "分数", fill = "") +
  coord_flip() +
  set_theme_panels(base_family = text_family)
```

<!-- 本区、本校和本校各班的描述性统计表 -->
```{r blai-tab, echo=FALSE, warning=FALSE, message=FALSE}
ability_summary <- ability_scores_combined_thisab %>%
  sum_tab()
ability_summary %>%
  rename(` ` = cls) %>%
  select(-region) %>%
  knitr::kable(digits = 2)
```

从表1-2中我们可以看出，【】班学生的表现最好，而【】【】班学生总体表现低于全校平均水平，在后期应该重点关注这【】个班级的基础能力发展情况，对于表现低于平均水平的学校应该定期实施干预。

从表1-4 中可以看到，每个班级的学生从等级优秀到不足的占比情况存在差异，应该重点关注在等级D中占比较大的班级，对学生的基础能力进行有计划的训练和干预。

<!-- 本区、本校和本校各班学生各个水平上的人数比例 -->
```{r blai-grading, echo=FALSE}
ability_summary %>%
  gather(level, n, A:D) %>%
  mutate(
    prop = n / 实测人数 * 100,
    prop_label = if_else(round(prop) == 0, NA_real_, round(prop))
  ) %>%
  ggplot(aes(cls, prop, fill = level, label = prop_label)) +
  geom_col(position = "stack", width = 0.5) +
  geom_text(position = position_stack(vjust = 0.5), size = 3) +
  facet_wrap(~ region, scales = "free_y", ncol = 1) +
  scale_fill_brewer(palette = "Blues") +
  labs(x = "", y = "比例（%）", fill = "") +
  coord_flip() +
  set_theme_panels(base_family = text_family)
```

本校学生总体在基础能力测评中各个水平的人数比例如下图1-5，其中，各水平的含义如下: A 水平:优秀；B水平：良好；C 水平:达到课程标准的基本要求；D 水平:未达到课程标准水平。

# 未来发展建议

## 重视基础能力教育

学科基础能力与各个学科成绩存在着高相关，所以可以通过培养学生的学科基础能力来达到增强学科成绩的目的；此外，在重视素质教育的今天，学科基础能力的培养能让学生在纷繁复杂的信息中得到真正的能力提升，加强基础能力建设。各区县和学校应该重视学生的基础能力教育，定期对能力较弱的学生及时进行干预和训练。

## 尊重发展规律

尊重初中生的认知能力发展规律，真正做到因材施教。研究表明，初中生抽象逻辑思维逐渐占主导地位，但具体形象成分还起作用，具有强烈的求知欲和探索精神，兴趣广泛，思想活跃，表现出较高的创造欲望。对于测评结果，我们应把握初中生思维的发展特点，目的是更好地发挥评价的导向作用，努力提高正面的积极因素，促进多元化评价的长效性。

## 认知能力训练

使用针对性的认知能力训练。认知能力训练主要是依据儿童认知能力发展规律，结合个体的认知能力发展特点，制定科学性的认知能力训练任务和训练日程，针对性地提高儿童认知能力水平。例如，为了加强思维力，可以让孩子每天坚持完成一些思维力训练的任务，并及时给出反馈。
